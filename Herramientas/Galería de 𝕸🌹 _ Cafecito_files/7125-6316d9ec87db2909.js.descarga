(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7125],{7125:function(e,a,n){"use strict";var t=n(5893),o=n(7294),s=n(1664),l=n.n(s),c=n(9367),i=n(3403),r=n(4157),u=n.n(r),d=n(4184),p=n.n(d),h=n(6154),m=n(6064),x=n(602),_=n(9417),g=n(7814);let f=()=>(0,t.jsxs)("span",{className:u().withOutPayment,children:["Debes agregar un m\xe9todo de pago desde la secci\xf3n de"," ",(0,t.jsx)(l(),{href:"/my_account?tab=payment#payment",children:"Mi cuenta"})," para empezar a recibir cafecitos."]}),b=()=>(0,t.jsx)("span",{className:u().withOutPayment,children:"El creador debe agregar un m\xe9todo de pago para empezar a recibir cafecitos."}),y=e=>{let{values:{monthsPlan:a,setMonthsPlan:n,setMonths:s,planSelected:l,setPlanSelected:c,name:i,setName:r,contact:d,setContact:p,message:h,setMessage:m}}=e,{post:f,plans:b,user:y,planPage:v,selectPlan:j}=(0,o.useContext)(x.Z),[P,C]=(0,o.useState)([]),[k,N]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{if(f){var e;let a=[];null==f||null===(e=f.plans)||void 0===e||e.map(e=>{let n=b.filter(a=>a._id==e);(null==n?void 0:n.length)&&a.push(n[0])}),C(a.sort((e,a)=>e.price-a.price)),a.length?N(!1):N(!0),c({...a[0]})}},[f]),(0,o.useEffect)(()=>{v&&(C(b.sort((e,a)=>e.price-a.price)),c({...j}))},[b,j]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:"Desbloquear contenido de ".concat(null==y?void 0:y.name)}),k?(0,t.jsx)("div",{style:{marginTop:"10px"},children:"Hubo un error al procesar el contenido. Habla con el creador del perfil para que configure los planes en este post."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:u().namePlan,children:[(0,t.jsx)("span",{children:"Plan"}),(0,t.jsxs)("label",{className:u().info,children:[(0,t.jsx)("select",{onChange:e=>{let a=P.filter(a=>a._id===e.target.value);c({...a[0]})},value:null==l?void 0:l._id,children:P.map(e=>(0,t.jsx)("option",{value:null==e?void 0:e._id,children:null==e?void 0:e.title},null==e?void 0:e._id))}),(0,t.jsx)(g.G,{icon:_.ptq,width:12})]})]}),(0,t.jsxs)("div",{className:u().containerInputCoffee,children:[(0,t.jsx)("span",{className:u().firstSpan,children:"Meses"}),(0,t.jsxs)("div",{className:u().countCoffeesContainer,children:[(0,t.jsx)("button",{onClick:()=>{a>1&&n(e=>Number(e)-1)},children:"-"}),(0,t.jsx)("input",{type:"text",placeholder:"1",value:a,onChange:e=>{s(e.target.value)}}),(0,t.jsx)("button",{onClick:()=>{n(e=>Number(e)+1)},children:"+"})]})]}),(0,t.jsxs)("div",{className:u().namePlan,children:[(0,t.jsx)("span",{children:"Contenido del plan"}),(0,t.jsx)("span",{className:u().info,children:"".concat(l.countPosts," ").concat(1===l.countPosts?"publicaci\xf3n":"publicaciones")})]}),(0,t.jsxs)("div",{className:u().namePlan,children:[(0,t.jsx)("span",{children:"AR$"}),(0,t.jsx)("span",{className:u().info,children:((null==l?void 0:l.price)||0)*a})]}),(0,t.jsx)("input",{type:"text",value:i,placeholder:"Nombre (opcional)",onChange:e=>{r(e.target.value)},className:u().inputName,maxLength:"50"}),(0,t.jsx)("input",{type:"text",value:d,placeholder:"Contacto (opcional, campo oculto al p\xfablico)",className:u().contactField,onChange:e=>{p(e.target.value)}}),(0,t.jsx)("textarea",{maxLength:"500",placeholder:"Mensaje (opcional)",value:h,onChange:e=>{m(e.target.value.slice(0,500))}}),(0,t.jsx)("div",{className:u().informationBuy,children:"* La compra del plan no es una suscripci\xf3n mensual, se har\xe1 un solo cobro correspondiente a la cantidad de meses seleccionados."}),(0,t.jsx)("div",{className:u().informationBuy,children:"* MercadoPago no procesa pagos del exterior de Argentina."})]})]})},v=e=>{let{isMobile:a,fetchComplete:n,loadingText:o}=e;return(0,t.jsx)("div",{className:u().loading,style:{display:!a&&n?"none":"block"},children:(0,t.jsx)("span",{children:o})})},j=e=>{let{isMobile:a,userSession:n,handleShowMore:s,show:l}=e,{user:r,setShowBuyPlan:d}=(0,o.useContext)(x.Z),[m,_]=(0,o.useState)(1),[g,j]=(0,o.useState)({}),[P,C]=(0,o.useState)(""),[k,N]=(0,o.useState)(""),[w,S]=(0,o.useState)(""),[B,W]=(0,o.useState)(!1),[I,M]=(0,o.useState)(!1),[O,T]=(0,o.useState)({mercadoPagoLink:"",qr:""}),[z,L]=(0,o.useState)("Creando link de pago..."),[E,H]=(0,o.useState)(!1);(0,o.useEffect)(()=>{H(l)},[l]);let Z="",q=async()=>{let e=(0,c.ZP)("".concat("https://cafecito.app"),{path:"/socket/socket.io"});e.on("sendToThankYouPageBuyer",()=>{window.location.href="".concat("https://cafecito.app","/").concat(r.username,"?thanks_plan=true")}),e.on("reconnect",()=>{e.emit("assignPlanBuyerId",{planBuyerId:Z})}),W(!0);try{let n=await h.Z.post("".concat("https://cafecito.app/api","/plan/checkout"),{monthsPlan:m||1,planId:g._id,QR:!a,name:P||"",contact:k||"",message:w||""},{withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json"}});a?n.data.mercadoPagoLink?window.location.href=n.data.mercadoPagoLink:L("Hubo un problema creando el cafecito. Intente nuevamente en unos minutos."):(s&&s(!0),e.emit("assignPlanBuyerId",{planBuyerId:n.data.planBuyerId}),Z=n.data.planBuyerId,T(n.data),M(!0))}catch(e){var n,t;L((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(t=n.data)||void 0===t?void 0:t.message)||"Hubo un problema creando el cafecito. Intente nuevamente en unos minutos.")}},F=e=>{e>0&&e.match(/^[0-9]+$/)?_(e):_(1)};return(0,t.jsx)("header",{className:u().inputText,children:(0,t.jsxs)("div",{className:p()(u().checkoutContainer,!(null==r?void 0:r.paymentMercadoPagoValid)&&u().checkoutNotValid),style:{display:E?"block":"none"},children:[(0,t.jsx)("div",{className:u().checkoutWrapper,children:B?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v,{isMobile:a,fetchComplete:I,loadingText:z}),!a&&I&&(0,t.jsx)(i.Z,{data:O})]}):(null==r?void 0:r.paymentMercadoPagoValid)?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(y,{values:{monthsPlan:m,setMonthsPlan:_,planSelected:g,setPlanSelected:j,setMonths:F,name:P,setName:C,contact:k,setContact:N,message:w,setMessage:S}}),Object.keys(g).length?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:u().payWithContainer,children:(0,t.jsx)("div",{className:u().payWithHR,children:(0,t.jsx)("div",{className:u().text,children:"Comprar ".concat(m," ").concat(1===m?"mes":"meses"," de plan")})})}),(null==r?void 0:r.paymentMercadoPagoValid)&&(0,t.jsx)("button",{className:u().sendButton,style:{background:"#c6e9fa"},onClick:q,children:(0,t.jsxs)("picture",{children:[(0,t.jsx)("source",{type:"image/webp",srcSet:"https://cdn.cafecito.app/imgs/version-horizontal-large-mp.webp, https://cdn.cafecito.app/imgs/version-horizontal-large-mp@2x.webp 2x, https://cdn.cafecito.app/imgs/version-horizontal-large-mp@4x.webp 4x",alt:"MercadoPago Logo",media:"(max-width: 768px)"}),(0,t.jsx)("source",{type:"image/webp",srcSet:"https://cdn.cafecito.app/imgs/version-horizontal-large-mp@2x.webp, https://cdn.cafecito.app/imgs/version-horizontal-large-mp@4x.webp 2x",alt:"MercadoPago Logo"}),(0,t.jsx)("img",{src:"https://cdn.cafecito.app/imgs/version-horizontal-large-mp@2x.png",alt:"MercadoPago Logo",loading:"lazy"})]})})]}):null]}):(null==n?void 0:n.username)==(null==r?void 0:r.username)?(0,t.jsx)(f,{}):(0,t.jsx)(b,{})}),(0,t.jsx)("div",{className:u().backgroundWithOpacity,onClick:()=>{H(!1),d(!1)}})]})})},P=e=>{let{user:a}=e;return{userSession:a}};a.Z=(0,m.$j)(P)(j)},602:function(e,a,n){"use strict";n.d(a,{e:function(){return s}});var t=n(7294);let o=t.createContext([]),s=o.Provider;a.Z=o},4157:function(e){e.exports={inputText:"buyPlan_inputText__nH_EU",openPopupCheckout:"buyPlan_openPopupCheckout__SqUTY",checkoutContainer:"buyPlan_checkoutContainer__39G_E",checkoutWrapper:"buyPlan_checkoutWrapper__s1oQa",checkoutNotValid:"buyPlan_checkoutNotValid__3vl_c",backgroundWithOpacity:"buyPlan_backgroundWithOpacity__3o_tT",informationBuy:"buyPlan_informationBuy__8ecoT",namePlan:"buyPlan_namePlan__qcIzQ",info:"buyPlan_info__oOGcD",withOutPayment:"buyPlan_withOutPayment__2aswv",loading:"buyPlan_loading__BObbd",containerInputCoffee:"buyPlan_containerInputCoffee__wvcws",imageCoffee:"buyPlan_imageCoffee__tnQ0G",selected:"buyPlan_selected__j32_5",firstSpan:"buyPlan_firstSpan__gdWR6",buttonCoffeesContainer:"buyPlan_buttonCoffeesContainer__fkuwN",countCoffeesContainer:"buyPlan_countCoffeesContainer__4LsaX",inputName:"buyPlan_inputName__33rrB",wrapperCheckbox:"buyPlan_wrapperCheckbox__Ce7km",checkmark:"buyPlan_checkmark__9sSqW",sendButton:"buyPlan_sendButton___X8ZU",payWithContainer:"buyPlan_payWithContainer___2vDU",payWithHR:"buyPlan_payWithHR__ucODM"}}}]);